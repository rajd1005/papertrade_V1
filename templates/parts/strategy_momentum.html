<div class="card shadow-sm border-0 bg-light mb-3">
    <div class="card-body p-2 p-md-3"> 
        
        <div class="accordion mb-3" id="momInstructions">
            <div class="accordion-item border-0 shadow-sm">
                <h2 class="accordion-header" id="momHeadingInst">
                    <button class="accordion-button collapsed py-2 fw-bold text-muted bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#momCollapseInst" style="font-size: 0.8rem;">
                        <i class="fas fa-chart-line me-2"></i> STRATEGY GUIDE & SETTINGS
                    </button>
                </h2>
                <div id="momCollapseInst" class="accordion-collapse collapse" data-bs-parent="#momInstructions">
                    <div class="accordion-body p-3 small text-muted bg-white">
                        <h6 class="fw-bold text-dark">Momentum Logic (VWAP + EMA)</h6>
                        <p class="mb-2">This strategy buys when Price > VWAP and Price > 9 EMA with RSI > 55 (for CE). It sells when Price < VWAP and Price < 9 EMA with RSI < 45 (for PE).</p>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="fw-bold text-dark mt-2">General Settings</h6>
                                <ul class="mb-1 ps-3">
                                    <li><b>Mode:</b> PAPER (Virtual), LIVE (Real), SHADOW (Monitor).</li>
                                    <li><b>Dir:</b> Direction Filter (BOTH, CE Only, PE Only).</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="fw-bold text-dark mt-2">Target Configuration</h6>
                                <ul class="mb-1 ps-3">
                                    <li><b>Legs:</b> Configure up to 3 exit targets.</li>
                                    <li><b>Trail:</b> "Cost" checkbox moves SL to Entry when target hit.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-2 g-md-3 align-items-center">
            
            <div class="col-12 col-md-3">
                <div class="d-flex align-items-center justify-content-between justify-content-md-start gap-3 h-100">
                    <div class="bg-white border rounded p-2 text-center shadow-sm" style="min-width: 80px; flex: 1 md-flex-none;">
                        <small class="d-block text-muted fw-bold" style="font-size: 0.65rem; letter-spacing: 1px;">STRATEGY</small>
                        <span class="fw-bold text-primary" style="font-size: 0.9rem;">MOMENTUM</span>
                    </div>
                    
                    <div class="text-end text-md-start">
                        <span class="badge bg-secondary mb-1 shadow-sm" id="mom_status_badge" style="font-size: 0.7rem;">OFFLINE</span>
                        <div class="small text-muted" style="font-size: 0.7rem;">
                            Lot Size: <span id="mom_lot_size" class="fw-bold text-dark">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-9">
                <div class="row g-2">
                    
                    <div class="col-6 col-md-4">
                        <div class="input-group input-group-sm shadow-sm">
                            <span class="input-group-text bg-white border-0 fw-bold text-muted px-2">Mode</span>
                            <select class="form-select fw-bold border-0" id="mom_mode_input" style="font-size: 0.8rem;">
                                <option value="PAPER" selected>塘 PAPER</option>
                                <option value="LIVE">閥 LIVE</option>
                                <option value="SHADOW">遜 SHADOW</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="input-group input-group-sm shadow-sm">
                            <span class="input-group-text bg-white border-0 fw-bold text-muted px-2">Dir</span>
                            <select class="form-select fw-bold border-0" id="mom_direction" style="font-size: 0.8rem;">
                                <option value="BOTH" selected>BOTH</option>
                                <option value="CE">CE Only</option>
                                <option value="PE">PE Only</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-12 col-md-4">
                        <div class="input-group input-group-sm shadow-sm">
                            <span class="input-group-text bg-white border-0 fw-bold text-muted px-2">Stop</span>
                            <input type="time" id="mom_cutoff" class="form-control fw-bold border-0" value="15:00" style="font-size: 0.9rem;">
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="bg-white rounded p-2 shadow-sm">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <small class="fw-bold text-muted" style="font-size: 0.7rem;">TARGET CONFIGURATION</small>
                                <small class="fw-bold text-primary" style="font-size: 0.7rem;">Total: <span id="mom_calc_total">0</span> Lots</small>
                            </div>
                            
                            <div class="row g-1 mb-1 text-center text-muted fst-italic" style="font-size: 0.6rem;">
                                <div class="col-1">#</div>
                                <div class="col-2">Active</div>
                                <div class="col-2">Lots</div>
                                <div class="col-2">Full</div>
                                <div class="col-3">Ratio</div>
                                <div class="col-2">Cost</div>
                            </div>

                            <div class="row g-1 mb-1 align-items-center">
                                <div class="col-1 text-center"><span class="badge bg-light text-dark border">1</span></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg1_active" class="form-check-input mom-leg-check" checked></div>
                                <div class="col-2"><input type="number" id="mom_leg1_lots" class="form-control form-control-sm text-center fw-bold bg-light mom-leg-input" value="1" min="1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg1_full" class="form-check-input mom-full-check"></div>
                                <div class="col-3"><input type="number" id="mom_leg1_ratio" class="form-control form-control-sm text-center mom-leg-input" value="1.0" step="0.1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg1_trail" class="form-check-input mom-trail-check" checked></div>
                            </div>

                            <div class="row g-1 mb-1 align-items-center">
                                <div class="col-1 text-center"><span class="badge bg-light text-dark border">2</span></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg2_active" class="form-check-input mom-leg-check" checked></div>
                                <div class="col-2"><input type="number" id="mom_leg2_lots" class="form-control form-control-sm text-center fw-bold bg-light mom-leg-input" value="1" min="1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg2_full" class="form-check-input mom-full-check"></div>
                                <div class="col-3"><input type="number" id="mom_leg2_ratio" class="form-control form-control-sm text-center mom-leg-input" value="2.0" step="0.1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg2_trail" class="form-check-input mom-trail-check"></div>
                            </div>

                             <div class="row g-1 align-items-center">
                                <div class="col-1 text-center"><span class="badge bg-light text-dark border">3</span></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg3_active" class="form-check-input mom-leg-check"></div>
                                <div class="col-2"><input type="number" id="mom_leg3_lots" class="form-control form-control-sm text-center fw-bold bg-light mom-leg-input" value="1" min="1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg3_full" class="form-check-input mom-full-check"></div>
                                <div class="col-3"><input type="number" id="mom_leg3_ratio" class="form-control form-control-sm text-center mom-leg-input" value="3.0" step="0.1"></div>
                                <div class="col-2 text-center"><input type="checkbox" id="mom_leg3_trail" class="form-check-input mom-trail-check"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="bg-white rounded p-2 shadow-sm">
                             <div class="d-flex justify-content-between align-items-center mb-1">
                                <small class="fw-bold text-muted" style="font-size: 0.7rem;">RISK & PNL MANAGEMENT</small>
                                <span class="badge bg-light text-dark border" style="font-size: 0.65rem;">SESSION PNL: <span id="mom_session_pnl" class="fw-bold">0.00</span></span>
                            </div>

                            <div class="row g-2">
                                <div class="col-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text border-0 bg-light p-1" style="font-size: 0.7rem;">Max Loss</span>
                                        <input type="number" id="mom_max_loss" class="form-control form-control-sm text-center fw-bold" placeholder="0" style="font-size: 0.8rem;">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text border-0 bg-light p-1" style="font-size: 0.7rem;">Trail (Pts)</span>
                                        <input type="number" id="mom_trail_pts" class="form-control form-control-sm text-center" placeholder="0" style="font-size: 0.8rem;">
                                    </div>
                                </div>
                                <div class="col-4">
                                     <div class="input-group input-group-sm">
                                        <span class="input-group-text border-0 bg-light p-1" style="font-size: 0.7rem;">Limit</span>
                                        <select class="form-select form-select-sm border-0 bg-white" id="mom_sl_to_entry" style="font-size: 0.75rem;">
                                            <option value="0">Off</option>
                                            <option value="1">Entry</option>
                                            <option value="2">T1</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="bg-white rounded p-2 shadow-sm border border-primary">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <small class="fw-bold text-primary" style="font-size: 0.7rem;">STRATEGY BACKTEST / SIMULATION</small>
                            </div>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-white border-0 fw-bold text-muted px-2">Date</span>
                                <input type="date" id="mom_backtest_date" class="form-control form-control-sm fw-bold">
                                <button class="btn btn-primary fw-bold text-white btn-sm" onclick="runMomBacktest()">
                                    <i class="fas fa-history"></i> Run Backtest
                                </button>
                            </div>
                            <small class="d-block mt-1 text-muted fst-italic" style="font-size: 0.65rem;">
                                Simulates Momentum signals on the selected date.
                            </small>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row g-2">
                            <div class="col-6 col-md-auto ms-md-auto">
                                <div class="bg-white rounded px-3 py-2 shadow-sm h-100 d-flex flex-column justify-content-center text-center">
                                    <small class="d-block text-muted fw-bold" style="font-size: 0.65rem;">TOTAL QTY</small>
                                    <span id="mom_total_qty" class="fw-bold text-success" style="font-size: 1rem;">--</span>
                                </div>
                            </div>

                            <div class="col-6 col-md-auto">
                                <button class="btn btn-success fw-bold w-100 shadow-sm h-100 d-flex align-items-center justify-content-center gap-2" 
                                        id="btn_mom_start" onclick="toggleMom('start')">
                                    <i class="fas fa-play"></i> <span>START</span>
                                </button>
                                
                                <button class="btn btn-danger fw-bold w-100 shadow-sm h-100 d-none align-items-center justify-content-center gap-2" 
                                        id="btn_mom_stop" onclick="toggleMom('stop')">
                                    <i class="fas fa-stop"></i> <span>STOP</span>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
